- def admin?
  - user_signed_in? and current_user.has_role? :admin
- num_roles = admin? ? @roles.length : 1
.container
  %h1 All Users
  - if @users.blank?
    %p There are no users!
  - else
    %table.table#user
      %thead
        %tr
          %th 
          %th Name
          - if user_signed_in?
            %th Email
          %th Company
          %th{ :colspan => num_roles, :class => 'text-center' } 
            - if !admin?
              Director
            - else
              Roles
          %th.text-center Avatar
          - if admin?
            %th{ :colspan => 3 }
        - if admin?
          %tr
            %th{ :colspan => 4 }
            - @roles.each do |r|
              %th.text-center= r.to_s.titlecase
            - if admin?
              %th{ :colspan => 3 }
          
      %tbody
        - @users.each do |user|
          %tr
            %td
              - if user.approved?
                %button.approved.btn.btn-xs.btn-success{ :id => "user-#{user.id}" } Unapprove
              - else
                %button.btn.btn-xs.btn-warning{ :id => "user-#{user.id}" } Approve
            %td= user.name
            - if user_signed_in?
              %td= user.email
            %td= user.company_or_org
            - if admin?
              - @roles.each do |r|
                %td.text-center= check_box_tag "role-#{r}-#{user.id}", r, user.has_role?(r)
            - else
              %td.text-center= user.has_role?('director') ? 'Director' : ''
            
            %td.text-center= user.avatar.blank? ? '(none)' : image_tag(user.avatar.url(:listing))
            - if admin?
              %td= link_to 'Show', user
              %td= link_to 'Edit', edit_user_path(user)
              %td= link_to 'Delete', user, :method => :delete, :data => { :confirm => 'Are you sure?' }