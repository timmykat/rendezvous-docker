<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OFX: OpenGL Acceleration of Rendering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="my_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OFX
   &#160;<span id="projectnumber">1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ofxOpenGLRender.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">OpenGL Acceleration of Rendering </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ofxOpenGLRenderIntro"></a>
Introduction</h1>
<p>The OfxOpenGLRenderSuite allows image effects to use OpenGL commands (hopefully backed by a GPU) to accelerate rendering of their outputs. The basic scheme is simple....</p>
<ul>
<li>An effect indicates it wants to use OpenGL acceleration by setting the ::kOfxImageEffectOpenGLRenderSupported flag on it's descriptor</li>
<li>A host indicates it supports OpenGL acceleration by setting ::kOfxImageEffectOpenGLRenderSupported on it's descriptor</li>
<li>In an effect's <a class="el" href="group__ImageEffectActions.html#gae66560a2d269b17e160613adf22fd7d0" title="Action called to have a plug-in define input an output clip preferences. ">kOfxImageEffectActionGetClipPreferences</a> action, an effect indicates what clips it will be loading images from onto the GPU's memory during an effect's <a class="el" href="group__ImageEffectActions.html#gabe7301ea1a415a8567ce6c80e863e28f" title="Action to render an image. ">kOfxImageEffectActionRender</a> action.</li>
</ul>
<h1><a class="anchor" id="ofxOpenGLRenderHouseKeeping"></a>
OpenGL House Keeping</h1>
<p>If a host supports OpenGL rendering then it flags this with the string property ::kOfxImageEffectOpenGLRenderSupported on its descriptor property set. Effects that cannot run without OpenGL support should examine this in <a class="el" href="group__ActionsAll.html#ga5fccb5c3c7d0f9259a6f9ba9163ed969" title="Action called to have a plug-in describe itself to the host, for more details see ArchitectureMainFun...">kOfxActionDescribe</a> action and return a <a class="el" href="group__StatusCodesGeneral.html#ga9464c4950f925a33b27cdc76c417855b" title="Status error code returned by plug-ins when they are missing host functionality, either an API or som...">kOfxStatErrMissingHostFeature</a> status flag if it is not set to "true".</p>
<p>Effects flag to a host that they support OpenGL rendering by setting the string property ::kOfxImageEffectOpenGLRenderSupported on their effect descriptor during the <a class="el" href="group__ActionsAll.html#ga5fccb5c3c7d0f9259a6f9ba9163ed969" title="Action called to have a plug-in describe itself to the host, for more details see ArchitectureMainFun...">kOfxActionDescribe</a> action. Effects can work in three ways....</p>
<ul>
<li>purely on CPUs without any OpenGL support at all, in which case they should set ::kOfxImageEffectOpenGLRenderSupported to be "false" (the default),</li>
<li>on CPUs but with optional OpenGL support, in which case they should set ::kOfxImageEffectOpenGLRenderSupported to be "true",</li>
<li>only with OpenGL support, in which case they should set ::kOfxImageEffectOpenGLRenderSupported to be "needed".</li>
</ul>
<p>Hosts can examine this flag and respond to it appropriately.</p>
<p>Effects can use OpenGL accelerated rendering during the following action...</p>
<ul>
<li><a class="el" href="group__ImageEffectActions.html#gabe7301ea1a415a8567ce6c80e863e28f" title="Action to render an image. ">kOfxImageEffectActionRender</a></li>
</ul>
<p>If an effect has indicated that it optionally supports OpenGL acceleration, it should check the property <a class="el" href="ofxOpenGLRender_8h.html#a1d461c655977438a9df6ec23e304663a" title="Indicates that an image effect SHOULD use OpenGL acceleration in the current action. ">kOfxImageEffectPropOpenGLEnabled</a> passed as an in argument to the following actions,</p>
<ul>
<li><a class="el" href="group__ImageEffectActions.html#gabe7301ea1a415a8567ce6c80e863e28f" title="Action to render an image. ">kOfxImageEffectActionRender</a></li>
<li><a class="el" href="group__ImageEffectActions.html#gaf37e1ebe7fd643a3c57a7ccfe4c91639" title="Action indicating a series of render calls are about to happen. ">kOfxImageEffectActionBeginSequenceRender</a></li>
<li><a class="el" href="group__ImageEffectActions.html#gaba73531897baba268b9a9e2d094c163a" title="Action to render a series of render calls have completed. ">kOfxImageEffectActionEndSequenceRender</a></li>
</ul>
<p>If this property is set to 0, then it should not attempt to use any calls to the OpenGL suite or OpenGL calls whilst rendering.</p>
<h1><a class="anchor" id="ofxOpenGLRenderGettingTextures"></a>
Getting Images as Textures</h1>
<p>An effect could fetch an image into memory from a host via the standard Image Effect suite "clipGetImage" call, then create an OpenGL texture from that. However as several buffer copies and various other bits of house keeping may need to happen to do this, it is more efficient for a host to create the texture directly.</p>
<p>The OfxOpenGLRenderSuiteV1::clipLoadTexture function does this. The arguments and semantics are similar to the OfxImageEffectSuiteV2::clipGetImage function, with a few minor changes.</p>
<p>The effect is passed back a property handle describing the texture. Once the texture is finished with, this should be disposed of via the OfxOpenGLRenderSuiteV1::clipFreeTexture function, which will also delete the associated OpenGL texture (for source clips).</p>
<p>The returned handle has a set of properties on it, analogous to the properties returned on the image handle by OfxImageEffectSuiteV2::clipGetImage. These are:</p>
<ul>
<li><a class="el" href="ofxOpenGLRender_8h.html#af124dcb8f827d04bd38a2169a7c9e914" title="Indicates the texture index of an image turned into an OpenGL texture by the host. ">kOfxImageEffectPropOpenGLTextureIndex</a></li>
<li><a class="el" href="ofxOpenGLRender_8h.html#a7cd67de6fad44abb4916e8cf715eff03" title="Indicates the texture target enumerator of an image turned into an OpenGL texture by the host...">kOfxImageEffectPropOpenGLTextureTarget</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#gaab5079daeead01325dd583aa90f1dc3a" title="Indicates the type of each component in a clip or image (after any mapping) ">kOfxImageEffectPropPixelDepth</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga45e33c156e25c31e8c27878354b97d5b" title="Indicates the current component type in a clip or image (after any mapping) ">kOfxImageEffectPropComponents</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#gab1636648e05f2b526eb7b87438dd2411" title="Indicates the premultiplication state of a clip or image. ">kOfxImageEffectPropPreMultiplication</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#gaf49ca39157ba8d220fd634d3348c4c53" title="The proxy render scale currently being applied. ">kOfxImageEffectPropRenderScale</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga46162857f576d29783968c38e133cfa2" title="The pixel aspect ratio of a clip or image. ">kOfxImagePropPixelAspectRatio</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga9cff5c74b9e3accc763eb3ea98a6e44e" title="The bounds of an image&#39;s pixels. ">kOfxImagePropBounds</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#gaf88fe3266af016a6db40315c3310e2d0" title="The full region of definition of an image. ">kOfxImagePropRegionOfDefinition</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga6ca85755c94f79991159086c38b2a28a" title="The number of bytes in a row of an image. ">kOfxImagePropRowBytes</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga1789fe96bbe0750446650d39117c36a7" title="Which fields are present in the image. ">kOfxImagePropField</a></li>
<li><a class="el" href="group__ImageEffectPropDefines.html#ga03e7ca5f2189d4fd89e3c17f6b0de35c" title="Uniquely labels an image. ">kOfxImagePropUniqueIdentifier</a></li>
</ul>
<p>The main difference between this and an image handle is that the <a class="el" href="group__ImageEffectPropDefines.html#gaec13c1bfeb69136978e3a0f46c9ca51f" title="The pixel data pointer of an image. ">kOfxImagePropData</a> property is replaced by the kOfxImageEffectPropOpenGLTextureIndex property. This integer property should be cast to a GLuint and is the index to use for the OpenGL texture. Next to texture handle the texture target enumerator is given in kOfxImageEffectPropOpenGLTextureTarget</p>
<p>Note, because the image is being directly loaded into a texture by the host it need not obey the Clip Preferences action to remap the image to the pixel depth the effect requested.</p>
<h1><a class="anchor" id="ofxOpenGLRenderOutput"></a>
Render Output Directly with OpenGL</h1>
<p>Effects can use the graphics context as they see fit. They may be doing several render passes with fetch back from the card to main memory via 'render to texture' mechanisms interleaved with passes performed on the CPU. The effect must leave output on the graphics card in the provided output image texture buffer.</p>
<p>The host will create a default OpenGL viewport that is the size of the render window passed to the render action. The following code snippet shows how the viewport should be rooted at the bottom left of the output texture.</p>
<pre class="fragment">  // set up the OpenGL context for the render to texture
  ...

  // figure the size of the render window
  int dx = renderWindow.x2 - renderWindow.x1;
  int dy = renderWindow.y2 - renderWindow.y2;

  // setup the output viewport
  glViewport(0, 0, dx, dy);</pre><p>Prior to calling the render action the host may also choose to bind the output texture as the current color buffer (render target), or they may defer doing this until clipLoadTexture is called for the output clip.</p>
<p>After this, it is completely up to the effect to choose what OpenGL operations to render with, including projections and so on.</p>
<h1><a class="anchor" id="ofxOpenGLRenderContext"></a>
OpenGL Current Context</h1>
<p>The host is only required to make the OpenGL context current (e.g., using wglMakeCurrent, for Windows) during the following actions:</p>
<ul>
<li><a class="el" href="group__ImageEffectActions.html#gabe7301ea1a415a8567ce6c80e863e28f" title="Action to render an image. ">kOfxImageEffectActionRender</a></li>
<li><a class="el" href="group__ImageEffectActions.html#gaf37e1ebe7fd643a3c57a7ccfe4c91639" title="Action indicating a series of render calls are about to happen. ">kOfxImageEffectActionBeginSequenceRender</a></li>
<li><a class="el" href="group__ImageEffectActions.html#gaba73531897baba268b9a9e2d094c163a" title="Action to render a series of render calls have completed. ">kOfxImageEffectActionEndSequenceRender</a></li>
<li><a class="el" href="ofxOpenGLRender_8h.html#ab9f4606fbc63f5d130198776c3087fca" title="Action called when an effect has just been attached to an OpenGL context. ">kOfxActionOpenGLContextAttached</a></li>
<li><a class="el" href="ofxOpenGLRender_8h.html#a3cc08b445353d0b9b682c078b0cdceda" title="Action called when an effect is about to be detached from an OpenGL context. ">kOfxActionOpenGLContextDetached</a></li>
</ul>
<p>For the first 3 actions, Render through EndSequenceRender, the host is only required to set the OpenGL context if <a class="el" href="ofxOpenGLRender_8h.html#a1d461c655977438a9df6ec23e304663a" title="Indicates that an image effect SHOULD use OpenGL acceleration in the current action. ">kOfxImageEffectPropOpenGLEnabled</a> is set. In other words, a plug-in should not expect the OpenGL context to be current for other OFX calls, such as <a class="el" href="group__ImageEffectActions.html#ga74948db76bb6c9d55256bd210325c0de" title="Action to describe an image effect in a specific context. ">kOfxImageEffectActionDescribeInContext</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Feb 17 2014 14:48:41 for OFX by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
